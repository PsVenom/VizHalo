import pyautogui
import time
from utils.capture import WindowCapture
from state.State import state
import pickle
import numpy as np
pyautogui.FAILSAFE = False
import keyboard
class Halogame(WindowCapture):
    def __init__(self):
        super().__init__(window_name='Halo')
        self.reset = pickle.load(open('C:/Users/Dell/PycharmProjects/MasterCheeks/state/recorded.pkl', 'rb'))
        self.x = 0
        self.y = 0
        self.drift = 32

    def new_episode(self):
        keyboard.play(self.reset)
        keyboard.press('d')

    def get_state(self):
        a = state()
        return a


    def set_additional_reward(self):
      a = state()
      reward_buffer = a.get_screensample()
      reward_ammo = a.get_ammo()
      reward_health = a.get_health()
      return reward_health, reward_buffer, reward_ammo
    def close(self):
        print('execution completed')
    def make_action(self,actions):
       #action code = {UP, DOWN, LEFT, RIGHT, W, S, A, D, melee, shoot, grenade}
       #the first four actions change orientation
       index = np.argmax(actions)
       keymove = ['i','k','j','l','w','s','a','d','f','n','m']
       keyboard.press(keymove[index])
       if index <= 3:

           time.sleep(0.00021)
           reward_movement = 0
           reward_shoot = 0
       elif index in range(4,8):
           time.sleep(0.21)
           reward_movement = 1
           reward_shoot = 0
       elif index == 9:
           reward_movement = 0
           reward_shoot = 1
       else:
           reward_movement = 0
           reward_shoot = 0
       keyboard.release(keymove[index])
       return reward_movement, reward_shoot



























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































